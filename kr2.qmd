---
title: "КР2 // Общие линейные модели"
subtitle: "Современные методы анализа данных // РАНХиГС"
format: html
editor: source
theme: materia
---

Максимальное количество баллов --- 10 (+1 дополнительный за задание 10.1)


```{r, include=FALSE}
library(tidyverse)
theme_set(theme_bw())
```

```{r, include=FALSE}
houses <- read_csv("data/house_price.csv")
str(houses)

table(houses$SaleCondition)
hist(houses$PoolArea)

table(houses$GarageCars)
table(houses$GarageType)
```

Продолжим работать с [данными о продаже домов](https://raw.githubusercontent.com/angelgardt/da-2023-ranepa/master/data/house_price.csv). Загрузите их и проверьте структуру. Если необходимо, исправьте типы переменных.

## Часть 1

### 1

У нас есть общая гипотеза, что площадь участка (`LotArea`) и условия продажи (`SaleCondition`) связаны c ценой продажи, внутри которой есть несколько частных:

* чем больше площадь участка, тем он дорожже
* в случае стандартных условий продажи (`Normal`) и продажи частично достроенного дома (`Partial`) цена будет выше, чем в случае нестандартной продажи (`Abnorml`)


**Выберите модель, с помощью которой можно проверить все указанные гипотезы --- как общую, так и частные. Обоснуйте свой выбор.**


### 2

**Отберите те дома, которые соответствуют интересующим нас условиям продажи (`SaleCondition`) --- `Normal`, `Abnorml` и `Partial`. Постройте модель для проверки заявленных гипотез.**


### 3

**Дайте статистическую и содержательную интерпретацию полученным результатам.**

<details>
<summary>А именно</summary>

Напоминаю, что необходимо:

* оценить модель в целом
* в зависимости от результатов предыдущего пункта --- значимость коэффициентов при предикторах
* в зависимости от результатов предыдущего пункта --- сами коэффициенты с точки зрения гипотез

</details>

### 4

**Проведите диагностику модели и оцените выполнение её допущений.**

<details>
<summary>А?</summary>

* Достаточно будет построить диагностические графики.
* Чтобы разместить четыре графика на одной картинке, воспользуйтесь `par(mfrow = c(2,2 ))`.

</details>

### 5

**Визуализируйте полученные результаты.**

<details>
<summary>Чиво?</summary>

* Тип графика зависит от типов переменных, с которыми вы работаете.
* Вероятно, двух осей вам не хватит --- присмотритесь к аргументу `color` функции `aes()` из `ggplot2`.

</details>

```{r, include=FALSE}
houses %>% 
    filter(SaleCondition %in% c("Abnorml", "Normal", "Partial")) -> houses_lm
model_lm <- lm(SalePrice ~ LotArea + SaleCondition, houses_lm)
summary(model_lm)
par(mfrow = c(2,2))
plot(model_lm)
houses_lm %>% 
    ggplot(aes(LotArea, SalePrice, color = SaleCondition)) +
    geom_point() +
    geom_smooth(method = "lm")
```





## Часть 2

### 6

У нас есть ещё одна гипотеза: тип гаража на участке (`GarageType`) и число машин, которые можно в нем разместить, (`GarageCars`) связаны c ценой продажи.

В рамках данных гипотез нас будут интересовать два типа гаражей (`GarageType`) --- отдельно стоящие (`Detchd`) и пристроенные к дому (`Attchd`) --- и только те гаражи, в которых можно разместить от 1 до 3 машин (`GarageCars`).

Дополнительно мы хотим выяснить, влияет ли каким-либо образом разное сочетание типа гаража и количества потенциально размещаемых машин на цену участка.

**Выберите модель, с помощью которой можно проверить все указанную гипотезу. Обоснуйте свой выбор.**


<details>
<summary>Осторожно, порог</summary>

Чтобы не споткнуться, подумайте о том, как лучше рассматривать количество машин в данном случае.

</details>


### 7

**Отберите те наблюдения, которые соответствуют интересующим нас условиям по типу гаража (`GarageType`) --- `Attchd`, `Detchd` --- и числу машин (`GarageCars`) --- от одной до трёх. Постройте модель для проверки заявленных гипотез.**


### 8

**Дайте статистическую и содержательную интерпретацию полученным результатам.**


<details>
<summary>Мб есть смысл упростить себе жизнь</summary>

Есть подозрение, что легче будет написать полную интерпретацию после решения задания 9.

</details>


### 9

**Оцените выполнение её допущений.**

<details>
<summary>А?</summary>

* Здесь ключевым вопросом является запределение моделируемой переменной.
* Также есть смысл посмотреть, что с количеством наблюдений в группах.

</details>


### 10

**Визуализируйте полученные результаты.**


<details>
<summary>Чиво?</summary>

* На графике нужно отобразить 95% доверительные интервалы.
* Вероятно, двух осей вам не хватит --- присмотритесь к аргументам `color` или `shape` функции `aes()` из `ggplot2`.

</details>


### 10.1 [Бонус]

Что случилось с отдельно стоящими гаражами на три машины?


```{r, include=FALSE}
houses %>% 
    filter(GarageType %in% c("Attchd", "Detchd") & GarageCars %in% 1:3) -> houses_aov

houses_aov %>% 
    group_by(GarageType, GarageCars) %>% 
    summarise(n())

hist(houses_aov$SalePrice)
houses_aov %>% 
    ggplot(aes(SalePrice)) +
    geom_histogram() +
    facet_grid(GarageType ~ GarageCars)

model_aov <- aov(SalePrice ~ as_factor(GarageCars) * GarageType, houses_aov)
summary(model_aov)
TukeyHSD(model_aov)



houses_aov %>% 
    ggplot(aes(as_factor(GarageCars), SalePrice, color = GarageType)) +
    stat_summary(fun.data = mean_cl_boot, geom = "pointrange")
```


## Критерии оценки

- **Задание 1 (max 1)**
    - 1 балл --- корретно выбрана модель для проверки заявленных гипотез И представленно верное обоснование выбора
    - 0 баллов --- некорректно выбрана модель ИЛИ представлено неверное обоснование выбора
- **Задание 2 (max 1)**
    - 1 балл --- выполнена фильтрация данных по заявленым условиям И корректно построена модель в соответствии и выбором в задании 1
    - 0 баллов --- модель построена некорретно ИЛИ фильтрация данных не выполнена
- **Задание 3 (max 1)**
    - 1 балл --- представлена полная И корректная статистическая интерпретация результатов И содержательная интерпретация значений коэффициентов, если она возможна
    - 0 баллов --- представлена неполная статистическая интерпретация ИЛИ некорректная статистическая интерпретация ИЛИ дана интерпретация значений коэффициентов в случае, когда она невозможна
- **Задание 4 (max 1)**
    - 1 балл --- произведена оценка качества модели и выполнения её допущений (любым способом с точки зрения реализации в коде), сделаны соответствующие выводы о качестве модели и выполнении её допущений
    - 0 баллов --- оценка качества модели отсутствует ИЛИ отсутствуют выводы по её результатам
- **Задание 5 (max 1)**
    - 1 балл --- построена корректная визуализация результатов анализа
    - 0 баллов --- визуализация результатов отсутствует ИЛИ содержит ошибки
- **Задание 6 (max 1)**
    - 1 балл --- корретно выбрана модель для проверки заявленных гипотез И представленно верное обоснование выбора
    - 0 баллов --- некорректно выбрана модель ИЛИ представлено неверное обоснование выбора
- **Задание 7 (max 1)**
    - 1 балл --- выполнена фильтрация данных по заявленым условиям И корректно построена модель в соответствии и выбором в задании 1
    - 0 баллов --- модель построена некорретно ИЛИ фильтрация данных не выполнена
- **Задание 8 (max 1)**
    - 1 балл --- представлена полная И корректная статистическая интерпретация результатов И их содержательная интерпретация
    - 0 баллов --- представлена неполная статистическая интерпретация ИЛИ некорректная статистическая интерпретация ИЛИ дана содержательная интерпретация в случае, когда она невозможна
- **Задание 9 (max 1)**
    - 1 балл --- произведена оценка выполнения допущений модели (любым способом с точки зрения реализации в коде), сделаны соответствующие выводы о качестве модели и выполнении её допущений
    - 0 баллов --- оценка выполнения допущений модели отсутствует ИЛИ отсутствуют выводы по её результатам
- **Задание 10 (max 1)**
    - 1 балл --- построена корректная визуализация результатов анализа
    - 0 баллов --- визуализация результатов отсутствует ИЛИ содержит ошибки
- **Задание 10.1 (max 1)**
    - 1 балл --- дан корректный ответ на поставленный вопрос с опорой на имеющиеся данные
    - 0 баллов --- дан некорректный ответ на поставленный вопрос с опорой на имеющиеся данные ИЛИ ответ не опирается на исследование данных
