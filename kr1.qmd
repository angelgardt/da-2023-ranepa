---
title: "КР1 // NHST"
subtitle: "Современные методы анализа данных // РАНХиГС"
format: html
editor: source
theme: materia
---

Максимальное количество баллов --- 10.


## Часть 1

Посмотрим на [данные о продаже домов](https://raw.githubusercontent.com/angelgardt/da-2023-ranepa/master/data/house_price.csv). Там много переменных --- нас будут интересовать две: год постройки (`YearBuilt`) и цена (`SalePrice`).

### 1

**Загрузите данные. Проверьте их структуру.**

А именно, корректно ли прочитались интересующие нас переменные.

```{r, include=FALSE}
library(tidyverse)
theme_set(theme_bw())
```

```{r, include=FALSE}
houses <- read_csv("data/house_price.csv")
str(houses)
```



### 2

**Проверьте гипотезу о том, что год постройки связан в ценой дома.**

Протестируйте соответствующую статистическую гипотезу на уровне значимости $\alpha = 0.001$.

**Дайте статистическую интерпретацию полученных результатов: значимы ли различия? что можно сказать о размере эффекта?**

```{r, include=FALSE}
cor.test(houses$YearBuilt, houses$SalePrice)
```



### 3

**Визуализируйте полученные результаты. Что можно сказать о получившейся визуализации? Выполняются ли допущения корреляционного анализа?**

```{r, include=FALSE}
houses |> 
    ggplot(aes(YearBuilt, SalePrice)) +
    geom_point() +
    geom_smooth(method = "lm")
```



## Часть 2

Теперь поработает с [экспериментальными данными](https://raw.githubusercontent.com/angelgardt/da-2023-ranepa/master/data/fastsearch.csv).

### Описание данных

В эксперименте испытуемым необходимо было искать целевые иконки среди дистракторов. Целевая иконка задавалась предъявлением изображения иконки перед экспериментальной пробой. Фиксиловались время реакции (`time`) и отчет испытуемого о нахождении целеовго стимула (`key`). Если испытуемый нашел целевую иконку в предъявленом наборе, он нажимал стрелку вправо (`right`), если не нашел --- влево (`left`). Варьировались следующие параметры: количество стимулов в пробе --- `3`, `6`, `9`, тип иконки --- плоская (`flat`) и с градиентом (`gradient`) и наличие тени у иконки (`shadow`). В эксперименте были обычные пробы, где присутствовал целевой стимул (`present`) и пробы-ловушки, в которых целевой стимул отсутствовал (`absent`).



### 4

**Загрузите [данные](https://raw.githubusercontent.com/angelgardt/da-2023-ranepa/master/data/fastsearch.csv). Проверьте их структуру. Отберите только корректные пробы.** 

Корректными считаются пробы, в которых был целевой стимул (`present`) и испытуемый отчитался о нахождении целевого стимула (`right`), и пробы, в которых целевого стимула не было (`absent`) и испытуемый отчитался о его отсутствии (`left`).


```{r, include=FALSE}
library(tidyverse)

fs <- read_csv("data/design_fastsearch.csv")
str(fs)
fs |> 
    mutate(type = ifelse(str_detect(cond, "^f"), "flat", "gradient"),
           shadow = ifelse(str_detect(cond, "s"), TRUE, FALSE),
           setsize = str_extract(cond, "\\d"),
           stimulus = ifelse(str_detect(cond, "p$"), "present", "absent"),
           key = str_remove_all(key, "'")) |> 
    select(-cond) |> 
    rename("trial" = `...1`) |> 
    write_csv("data/fastsearch.csv")
```


```{r, include=FALSE}
fs <- read_csv("data/fastsearch.csv")
str(fs)
fs |> filter(stimulus == "present" & key == "right" | stimulus == "absent" & key == "left") -> fs_correct
```



### 5

**Удалите из данных выбросы.**

Считайте выбросами те пробы, в которых время реакции (`time`) отклоняется от среднего значения (среднего арифметического), более чем на 2.5 стандартных отклонения. Учтите при определении выброса группировку данных по экспериментальным условиям --- количеству стимулов в пробе, типу стимула и наличию тени, а также по идентификатору испытуемого (`id`).

<details>
<summary>Может пригодиться код</summary>
```
is_outlier <- function(x) {!(x < mean(x) + 2.5 * sd(x) & x > mean(x) - 2.5 * sd(x))}
```
</details>

```{r, include=FALSE}
is_outlier <- function(x) {!(x < mean(x) + 2.5 * sd(x) & x > mean(x) - 2.5 * sd(x))}
fs_correct |> 
    group_by(type, shadow, setsize, id) |> 
    mutate(is_outlier = is_outlier(time)) |> 
    filter(!is_outlier) -> fs_clean
```



### 6

**Протестируйте гипотезу о том, что фактор наличия тени ускоряет поиск целевой иконки.** 

Учтите, что данные не аггрегированы и каждое наблюдение --- это отдельная экспериментальная проба.

**Дайте статистическую интерпретацию полученных результатов: значимы ли различия? что можно сказать о размере эффекта?**

```{r, include=FALSE}
fs_clean |> 
    ungroup() |> 
    group_by(id, shadow) |> 
    summarise(rt = mean(time)) -> fs_agg
t.test(fs_agg$rt ~ fs_agg$shadow)
#t.test(fs_clean$time ~ fs_clean$shadow)
```

<details>
<summary>А?</summary>
```
?t.test
```
[Stepik](https://stepik.org/lesson/11504/step/1?unit=2527)
</details>



### 7

**Визуализируйте полученные результаты.**

<details>
<summary>Хм...</summary>
`stat_summary()`, `geom = "pointrange"`
</details>

```{r, include=FALSE}
fs_agg |> 
    ggplot(aes(shadow, rt)) +
    stat_summary(fun.data = mean_cl_boot, geom = "pointrange")
```





## Критерии оценки

- **Задание 1 (max 1)**
    - 1 балл --- данные загружены, проверена их структура, скорректированы типы данных (при необходимости)
    - 0 баллов --- данные не загружены ИЛИ их структура не проверена ИЛИ типы данных не скорректированы (при необходимости)
- **Задание 2 (max 1)**
    - 1 балл --- выполнена проверка заявленной гипотезы, дана корректная статистическая интерпретация результатов
    - 0 баллов --- не выполнена проверка гипотезы ИЛИ дана некорректная статистическая интерпретация ИЛИ не дана статистическая интерпретация результатов
- **Задание 3 (max 2)**
    - 2 балла --- построена корректная визуализация, представлена её интерпретация с позиции выполнения допущений корреляционного анализа
    - 1 балл --- построена корректная визуализация, её интерпретация с позиции выполнения допущений корреляционного анализа отсутствует
    - 0 баллов --- визуализация результатов отсутствует ИЛИ отсутствует её интерпретация с позиции выполнения допущений корреляционного анализа
- **Задание 4 (max 1)**
    - 1 балл --- данные загружены, проверена их структура, скорректированы типы данных (при необходимости), из данных удалены некорретные пробы
    - 0 баллов --- данные не загружены ИЛИ не выполнена проверка структуры данных ИЛИ не скорретированы типы данных (при необходимости) ИЛИ не выполнено удаление некорретных проб
- **Задание 5 (max 1)**
    - 1 балл --- из данных удалены статистические выбросы с учетом группировки данных
    - 0 баллов --- из данных удалены статистические выбросы без учета группировки данных ИЛИ статистические выбросы не удалены
- **Задание 6 (max 2)**
    - 2 балла --- данные аггрегированы, выбран корретный статистический метод проверки гипотезы, выполнено тестирование гипотезы, дана корретная статистическая интерпретация результатов
    - 1 балл --- выбран корретный статистический метод проверки гипотезы, выполнено тестирование гипотезы на неаггрегированных данных, дана корректная статистическая интерпретация результатов
    - 0 баллов --- выбран некорретный статистический метод проверки гипотезы ИЛИ дана некорретная статистическая интерпретация результатов
- **Задание 7 (max 2)**
    - 2 балла --- выбран подходящий способ визуализации результатов, построенная визуализация не содерит ошибок
    - 1 балл --- выбран подходящий способ визуализации результатов, построенная визуализация содержит ошибки
    - 0 баллов --- выбран некорретный способ визуализации результатов ИЛИ визуализация результатов отсутствует
